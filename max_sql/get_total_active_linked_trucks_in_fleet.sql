select count(ftl.truck_id) as linked_trucks, f.name from udo_fleettrucklink as ftl left join udo_fleet as f on (f.id=ftl.fleet_id) left join udo_truck as t on (t.id=ftl.truck_id) left join daterangevalue as drv on (drv.objectInstanceId=ftl.id) where ftl.fleet_id IN (select ftl.fleet_id from udo_fleettrucklink as ftl left join udo_truck as t on (t.id=ftl.truck_id) left join udo_fleet as f on (f.id=ftl.fleet_id) left join daterangevalue as drv on (drv.objectInstanceId=ftl.id) where f.name!='Entire Active Fleet' and t.id=2918 and drv.type='FleetTruckLink' and (drv.endDate IS NULL or drv.endDate > DATE(CONCAT(CURDATE(), ' 00:00:00')))) and drv.type='FleetTruckLink' and (drv.endDate IS NULL or drv.endDate > DATE(CONCAT(CURDATE(), ' 00:00:00'))) group by ftl.fleet_id order by linked_trucks;

